{%- comment -%}
Klevu search
{%- endcomment -%}
{%- assign domain = shop.permanent_domain -%}
{%- assign klevu_api_key = settings.klevu_api_key -%}
{%- assign klevu_language = 'de' -%}
{%- if klevu_api_key != blank -%}
<script src="https://js.klevu.com/klevu-js-v1/js/klevuScript.js?klevuapi={{klevu_api_key}}&lang={{klevu_language}}&shop={{domain}}"></script>
{{ 'https://js.klevu.com/klevu-js-v1/customizations/klevu-user-customization-163215612183714256.js' | script_tag }}

{%- comment -%}
Klevu product recommendations
{%- endcomment -%}
<script type="text/javascript">
  {% if template == 'collection'%}
      var klevu_page_meta = {
          "pageType": "category",
          "categoryName": "{{collection.title | escape }}",
          "categoryUrl": "{{shop.url}}{{collection.url}}",
      };
  {% endif %}
  {% if template == 'product'%}
      var klevu_page_meta  = {
          "pageType": "pdp",
          "itemName": "{{product.title | escape }}",
          "itemUrl": "{{shop.url}}{{ product.url}}",
          "itemId": "{{product.selected_or_first_available_variant.id}}",
          "itemGroupId": "{{product.id}}",
          "itemSalePrice": "{{product.price}}",
          "itemCurrency": "{{shop.currency}}"
      };
  {% endif %}
  {% if template == 'cart'%}
      var cartRecords = [];
      {% for item in cart.items %}
          cartRecords.push({'itemId': {{item.variant_id}} ,'itemGroupId': {{item.product_id}} });
      {% endfor %}
      var klevu_page_meta = {
          "pageType": "cart",
          "cartRecords": cartRecords
      };
  {% endif %}
</script>
<script src="https://js.klevu.com/core/v2/klevu.js"></script>
<script src="https://js.klevu.com/recs/v2/klevu-recs.js"></script>
<script type="text/javascript">
  klevu.coreEvent.attach("setRemoteConfigRecsBaseUpdates", {
    name: "klevuRECSCustomizationCurrency",
    fire: function () {
      klevu.recs.base.getScope().chains.search.control.add({
        name: "productCurrencyRECS",
        fire: function (data, scope) {
          var parentScope = scope.recsScope;
          parentScope.searchObject.getScope().currency.setCurrencys({
            'EUR': {
              string: "EUR",
              format: "%s %s",
              atEnd: false,
              precision: 2,
              thousands: ",",
              decimal: ",",
              grouping: 3
            }
          });
          parentScope.searchObject.getScope().currency.mergeToGlobal();
        }
      });
    }
  });
  klevu.interactive(function () {
      var options = {
          powerUp: {
              recsModule: true
          },
          recs: {
              apiKey: '{{ klevu_api_key }}'
          },
          analytics: {
              apiKey: '{{ klevu_api_key }}'
          }
      };
      klevu(options);
  });
</script>
{%- endif -%}
